@model IEnumerable<ViveirosID.Models.Artigos>

@{
    ViewBag.Title = "Pesquisa";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Pesquisa</h2>

<p>

    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">

            <table style="border:1px solid">
                <tr>
                    <td style="width:400px">
                        <!-- INPUT PARA PALAVRAS A PESQUISAR-->
                        Pesquisar:     <input type="text" name="nome"><br>
                    </td>
                    <td style="width:400px">
                        <!-- INPUT PARA PESO -->
                        <label for="peso">Peso:</label>
                        <div id="slider-peso" style="width:300px"></div>
                        <div id="peso-div"></div>
                        <input type="text" id="peso" name="peso" style="width:300px; display:none" readonly />
                    </td>
                    <td style="width:400px">
                        <!-- INPUT PARA PREcO -->
                        <label for="preco">Preco: </label>
                        <div id="slider-preco" style="width:300px"></div>
                        <div id="preco-div"></div>
                        <input type="text" id="preco" name="preco" style="width:300px; display:none" readonly />
                    </td>
                </tr>
                <tr>
                    <td style="width:400px">
                        <!-- INPUT PARA crescimento-->
                        <label for="crescimento">crescimento: </label>
                        <div id="slider-crescimento" style="width:300px"></div>
                        <div id="crescimento-div"></div>
                        <input type="text" id="crescimento" name="crescimento" style="width:300px; display:none" readonly />
                    </td>
                    <td style="width:400px">
                        <!-- INPUT PARA luz-->
                        <label for="luz">luz: </label>
                        <div id="slider-luz" style="width:300px"></div>
                        <div id="luz-div"></div>
                        <input type="text" id="luz" name="luz" style="width:300px; display:none" readonly />
                    </td>
                    <td style="width:400px">
                        <!-- INPUT PARA rega-->
                        <label for="rega">rega: </label>
                        <div id="slider-rega" style="width:300px"></div>
                        <div id="rega-div"></div>
                        <input type="text" id="rega" name="rega" style="width:300px; display:none" readonly />
                    </td>
                </tr>
            </table>

            <button>Pesquisa</button>
        </div>
    }

    <table class="table">
        <tr>
            <th>
                tipo
            </th>
            <th>
                nome
            </th>
            <th>
                nome tecnico
            </th>
            <th>
                disponibilidade
            </th>
            <th>
                descricao
            </th>
            <th>
                plantacao comeca
            </th>
            <th>
                plantacao acaba
            </th>
            <th>
                peso
            </th>
            <th>
                crescimento
            </th>
            <th>
                luz
            </th>
            <th>
                rega
            </th>
            <th>
                preco
            </th>
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Categoria.tipo)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.nome)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.nometecnico)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.disponibilidade)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.descricao)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.plantacaoComeca)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.plantacaoAcaba)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.peso)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.crescimento)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.luz)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.rega)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.preco)
                </td>

                <td>
                    @if (Request.IsAuthenticated && User.IsInRole("Administrador"))
                    {
                        @Html.ActionLink("Edit", "Edit", new { id = item.ArtigoID })} |
                    @Html.ActionLink("Details", "Details", new { id = item.ArtigoID }) |
                    @if (Request.IsAuthenticated && User.IsInRole("Administrador"))
                    {
                        @Html.ActionLink("Delete", "Delete", new { id = item.ArtigoID })}|
                    @Html.ActionLink("Adiciona", "Adiciona", new { id = item.ArtigoID })
                </td>
            </tr>
        }

    </table>

    <script type="text/javascript">
        $(document).ready(function () {

            var primeiro_peso_jq = @ViewBag.primeiro_peso;
            var ultimo_peso_jq = @ViewBag.ultimo_peso;
            var primeiro_preco_jq = @ViewBag.primeiro_preco;
            var ultimo_preco_jq = @ViewBag.ultimo_preco;
            var primeira_rega_jq = @ViewBag.primeira_rega;
            var ultima_rega_jq = @ViewBag.ultima_rega;
            var primeira_luz_jq = @ViewBag.primeira_luz;
            var ultima_luz_jq = @ViewBag.ultima_luz;
            var primeiro_crescimento_jq = @ViewBag.primeiro_crescimento;
            var ultimo_crescimento_jq = @ViewBag.ultimo_crescimento;

            var luz_jq = ["Sombra-Total", "Sombra-Parcial", "Meia-Sombra", "Meio-Sol", "Sol"];

            var crescimento_jq = ["Lento", "Moderado", "Normal", "Acelarado", "Rápido"];

            var rega_jq = ["Seca", "Quase-Seca", "Humido", "Molhado", "Encharcado"];

            // Funcão que deve disparar com um click no elemento "file"
            //
            $(function(){
                //alert("chourico");
                $("#file").click(function(){
                    var input = $("#file").value;
                    if (input.files && input.files[0]) {

                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $('#imgpreview').css('visibility', 'visible');
                            $('#imgpreview').attr('src', e.target.result);
                        }
                        reader.readAsDataURL(input.files[0]);
                    }
                });
            });

            // Slider para selecionar a quantidade de água necessária na rega
            //
            $("#slider-rega").slider({
                range: true,
                min: primeira_rega_jq,
                max: ultima_rega_jq,
                step: 1,
                values: [primeira_rega_jq, ultima_rega_jq],
                slide: function (event, ui) {
                    $("#rega-div").text("Terra de " + rega_jq[ui.values[0]] + " até " + rega_jq[ui.values[1]]);
                    $("#rega").val(ui.values[0] + " " + ui.values[1]);
                }
            });

            // Funcão para atribuir um valor inicial ao valor a ser escolhido para quantidade de água necessária na rega
            // Tanto na label como no input
            //
            $("#rega-div").text("Terra de " + rega_jq[$("#slider-rega").slider("values", 0)] +
              " até " + rega_jq[$("#slider-rega").slider("values", 1)]);
            $("#rega").val($("#slider-rega").slider("values", 0) + " " + $("#slider-rega").slider("values", 1));

            // Slider para selecionar a gama de luzes a serem utilizadas
            //
            $("#slider-luz").slider({
                range: true,
                min: primeira_luz_jq,
                max: ultima_luz_jq,
                step: 1,
                values: [primeira_luz_jq, ultima_luz_jq],
                slide: function (event, ui) {
                    $("#luz-div").text("Luminosidade de " + luz_jq[ui.values[0]] + " até " + luz_jq[ui.values[1]]);
                    $("#luz").val(ui.values[0] + " " + ui.values[1]);
                }
            });

            // Funcão para atribuir um valor inicial ao valor a ser escolhido para as gamas de luz
            //
            $("#luz-div").text("Luminusidade de " + luz_jq[$("#slider-luz").slider("values", 0)] +
              " até " + luz_jq[$("#slider-luz").slider("values", 1)]);
            $("#luz").val($("#slider-luz").slider("values", 0) + " " + $("#slider-luz").slider("values", 1));

            // Slider para selecionar a gama de velocidades de crescimento a pesquisar
            //
            $("#slider-crescimento").slider({
                range: true,
                min: primeiro_crescimento_jq,
                max: ultimo_crescimento_jq,
                step: 1,
                values: [primeiro_crescimento_jq, ultimo_crescimento_jq],
                slide: function (event, ui) {
                    $("#crescimento-div").text("crescimento de " + crescimento_jq[ui.values[0]] + " até " + crescimento_jq[ui.values[1]]);
                    $("#crescimento").val(ui.values[0] + " " + ui.values[1]);
                }
            });

            // Funcão para atribuir um valor inicial ao valor a ser escolhido para velocidade de crescimento
            //
            $("#crescimento-div").text("crescimento de " + crescimento_jq[$("#slider-crescimento").slider("values", 0)] +
              " até " + crescimento_jq[$("#slider-crescimento").slider("values", 1)]);
            $("#crescimento").val($("#slider-crescimento").slider("values", 0) + " " + $("#slider-luz").slider("values", 1));

            // Slider para selecionar a gama de pesos a pesquisar
            //
            $("#slider-peso").slider({
                range: true,
                min: primeiro_peso_jq,
                max: ultimo_peso_jq,
                step: ((ultimo_peso_jq -  primeiro_peso_jq) / 50),
                values: [primeiro_peso_jq, ultimo_peso_jq],
                slide: function (event, ui) {
                    $("#peso-div").text("Peso de " + ui.values[0] + " gramas até " + ui.values[1] + " gramas");
                    $("#peso").val(ui.values[0] + " " + ui.values[1]);
            }
            });

            // Funcão para atribuir um valor inicial ao valor a ser escolhido para peso
            //
            $("#peso-div").text("Peso de " + $("#slider-peso").slider("values", 0) +
              " gramas até " + $("#slider-peso").slider("values", 1) + " gramas");
            $("#peso").val($("#slider-peso").slider("values", 0) + " " + $("#slider-peso").slider("values", 1));

            // Slider para selecionar a gama de precos a pesquisar
            //
            $("#slider-preco").slider({
                range: true,
                min: primeiro_preco_jq,
                max: ultimo_preco_jq,
                step: ((ultimo_preco_jq - primeiro_preco_jq) / 50),
                values: [primeiro_preco_jq, ultimo_preco_jq],
                slide: function (event, ui) {
                    $("#preco-div").text("de €" + ui.values[0] + " até €" + ui.values[1]);
                    $("#peso").val(ui.values[0] + " " + ui.values[1]);
                }
            });

            // Funcão para atribuir um valor inicial ao valor a ser escolhido para preco
            //
            $("#preco-div").text("de €" + $("#slider-preco").slider("values", 0) +
              " até €" + $("#slider-preco").slider("values", 1));
            $("#preco").val($("#slider-preco").slider("values", 0) + " " + $("#slider-preco").slider("values", 1));
        });
    </script>
